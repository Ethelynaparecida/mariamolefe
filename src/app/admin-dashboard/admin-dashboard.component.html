<div class="admin-container">

  <h2>DPainel de Controle Maria Mole</h2>

  <div class="panels-wrapper">

    <div class="panel controls-panel">
      <h3>Controles</h3>
      <div class="button-group">
        <button *ngIf="!isPaused" class="btn-pause" (click)="pause()">
          Pausar Player
        </button>
        <button *ngIf="isPaused" class="btn-play" (click)="play()">
          Continuar Player
        </button>
      
        <button class="btn-restart" (click)="restart()" [disabled]="!currentSong">
          Recome칞ar M칰sica
        </button>
      
        <button class="btn-skip" (click)="skip()" [disabled]="!currentSong">
          Pular M칰sica Atual
        </button>
      </div>
      <div class="links-section">
        <a href="/player" target="_blank" class="btn-link btn-tv">
          游닠 Abrir tela do video(Player)
        </a>
        <a routerLink="/admin/log" class="btn-link btn-log">
          游늶 Ver Hist칩rico de M칰sicas (칔ltimas 4h)
        </a>
        <a routerLink="/admin/users" class="btn-link btn-users">
          游녻 Ver Lista de Usuarios
        </a>
      </div>
    </div>

    <div class="panel queue-panel">
      <h3>Fila de M칰sicas</h3>
      <div class="queue-section">
        <h4>A Tocar Agora</h4>
        <div *ngIf="currentSong; else filaVazia" class="queue-item current">
          <span class="q-title" [innerHTML]="currentSong.titulo"></span>
          <span class="q-user"> por {{ currentSong.nomeUsuario }}</span>
        </div>
      </div>
      <div class="queue-section">
        <h4>Pr칩ximas na Fila</h4>
        <div *ngIf="upcomingSongs.length > 0; else proximasVazia">
          <ol class="queue-list">
            <li *ngFor="let song of upcomingSongs" class="queue-item">
              <span class="q-title" [innerHTML]="song.titulo"></span>
              <span class="q-user"> por {{ song.nomeUsuario }}</span>
            </li>
          </ol>
        </div>
      </div>
      <ng-template #filaVazia>
        <p class="empty-text">A fila de m칰sicas est치 vazia.</p>
      </ng-template>
      <ng-template #proximasVazia>
        <p class="empty-text">Nenhuma m칰sica na fila de espera.</p>
      </ng-template>
    </div>

    <div class="panel search-panel">
      <h3>Adicionar M칰sica (Admin)</h3>
      <p>Adicione uma m칰sica para um convidado.</p>

    <form [formGroup]="adminSearchForm">
        
  <div class="form-group">
    <label for="nomeConvidado">Nome do Convidado:</label>
    <input id="nomeConvidado" type="text" formControlName="nome" placeholder="Ex: Jo칚o Silva">
    
    <div *ngIf="adminSearchForm.get('nome')?.invalid && adminSearchForm.get('nome')?.touched" class="error-message">
      칄 preciso preencher o nome antes de continuar.
    </div>
  </div>

  <div class="form-group search-bar" (click)="onDisabledClick()">
    <input type="text" formControlName="query" placeholder="Buscar m칰sica..."
           [disabled]="adminSearchForm.get('nome')?.invalid ?? true">

    <button (click)="onAdminSearch($event)" 
            [disabled]="adminSearchForm.get('nome')?.invalid || adminSearchForm.get('query')?.value === '' || isSearching">
      <span *ngIf="!isSearching">Buscar</span>
      <span *ngIf="isSearching">...</span>
    </button>
    </div>

  <div class="divider-text">ou</div>

  <div class="form-group search-bar" (click)="onDisabledClick()">
    <input type="text" formControlName="videoUrl" placeholder="Cole a URL do YouTube..."
           [disabled]="adminSearchForm.get('nome')?.invalid ?? true">

    <button (click)="onAdminAddByUrl($event)"
            [disabled]="adminSearchForm.get('nome')?.invalid || adminSearchForm.get('videoUrl')?.invalid || isAddingByUrl">
      <span *ngIf="!isAddingByUrl">Adicionar</span>
      <span *ngIf="isAddingByUrl">...</span>
    </button>
    </div>
  
  </form>

      <div class="results-container">
      </div>

    </div>
  </div>
  <div class="quota-section">
        <h4>Uso da Cota (Di치rio)</h4>
        <div *ngIf="!quotaUsage" class="loading-quota">A carregar...</div>
        <div *ngIf="quotaUsage">
          <p>
            Unidades Usadas: 
            <strong>{{ quotaUsage.unidadesUsadas }} / {{ quotaUsage.limiteDiario }}</strong>
          </p>
          <progress [value]="quotaUsage.unidadesUsadas" [max]="quotaUsage.limiteDiario"></progress>
          
          <p class="buscas-restantes">
            Buscas Restantes: <strong>~{{ quotaUsage.buscasRestantesEstimadas }}</strong>
          </p>
        </div>
      </div>

  <div *ngIf="feedbackMessage" class="feedback">
    {{ feedbackMessage }}
  </div>
</div>